Restored type checking and repaired broken exclusion.